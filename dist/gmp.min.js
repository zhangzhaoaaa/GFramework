/*
 * gmp v1.1.1
 * (c) 2016 zeromike
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.GMP=e()}(this,function(){"use strict";function t(t){t._assignPros({_init:function(t){t=t||{},this._uid="g"+w++,_(this,t),this.el=this.el||"body",this._eventsMapList={},this._initState(),this._initEvents(),this._initEls(),this._callHook("init")}})}function e(t){return function(e){return k.toString.call(e)==="[object "+t+"]"}}function n(t){t._assignPros({_initEvents:function(){i(this,this.events)},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this._uid),this},delegateEvents:function(t){if(t||(t=this.events),!t)return this;this.undelegateEvents();for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if(m.isFunction(n)||(n=this[n]),!n)continue;var i=e.match(j);this.delegate(i[1],i[2],n.bind(this))}return this},undelegate:function(t,e,n){return this.$el.off(t+".delegateEvents"+this._uid,e,n),this},delegate:function(t,e,n){return this.$el.on(t+".delegateEvents"+this._uid,e,n),this},_setElement:function(e){this.$el=e instanceof t.$()?e:t.$()(e),this.el=this.$el[0]},_callHook:function(t){var e=this[t];t&&e&&e.call(this)},on:function(t,e){var n=this._uid+t;this._eventsMapList[n]?this._eventsMapList[n].push(e):this._eventsMapList[n]=[e]},off:function(t){var e=this._uid+t;this._eventsMapList[e]&&(this._eventsMapList[e]=[])},trigger:function(t,e){var n=this,i=this._uid+t,r=this._eventsMapList[i];r&&r.forEach(function(t){t.apply(n,[e])})},destroy:function(){this.undelegateEvents(),this.$el.empty()}})}function i(t,e){return t.undelegateEvents(),t._setElement(t.el),t.delegateEvents(e),t}function r(t){t._assignPros({_initState:function(){this._initData()},_initData:function(){var t=this;this._data=this.data||{};for(var e=Object.keys(this._data),n=this,i=function(){var i=e[r],o=t._data[e[r]];return a=Object.getOwnPropertyDescriptor(t._data,i),a&&a.configurable===!1?"continue":void Object.defineProperty(n._data,i,{enumerable:!0,configurable:!0,get:function(){return o},set:function(t){var e=o;m.equal(t,e)||(o=t,n.trigger("change:"+i))}})},r=0,o=e.length;r<o;r++){var a;i()}},_initEls:function(){var e=this;this.els&&Object.keys(this.els).forEach(function(n){e.els[n]=e.els[n]instanceof t.$()?e.els[n]:t.$()(e.els[n])})}})}function o(t){var e={},n=function(t,n,i){e[t]=e[t]||[],e[t].push({scope:i||this,handler:n})},i=function(t,n,i){var r=e[t];i=i||this,r&&(e[t]=e[t].filter(function(t){return!!(n&&n!==t.callback||i&&i!==t.scope)}))},r=function(t){var n,i,r,o=e[t];if(o){for(var a=arguments.length,s=Array(a>1?a-1:0),u=1;u<a;u++)s[u-1]=arguments[u];for(n=0,r=o.length;n<r;n++)i=o[n],i.handler.apply(i.scope,s||[])}};t.GMPEvents={on:n,off:i,trigger:r,_events:e}}function a(t){A=I.test(t)?t:document.getElementById(t).innerHTML||"";var e=RegExp([(T.escape||D).source,(T.interpolate||D).source,(T.evaluate||D).source].join("|")+"|$","g"),n=0,i="__p+='";A.replace(e,function(t,e,r,o,a){return i+=A.slice(n,a).replace(L,W),n=a+t.length,e?i+="'+\n((__t=("+e+"))==null?'':_t.escape(__t))+\n'":r?i+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(i+="';\n"+o+"\n__p+='"),t}),i+="';\n",i="with(obj||{}){\n"+i+"}\n",i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var r=new Function("obj",i)}catch(o){throw o.source=i,o}var a=function(t){return r.call(this,t)},s="obj";return a.source="function("+s+"){\n"+i+"}",a}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={"click .okBtn":"ok","click .cancelBtn":"cancel"};t.events?m.defaults(t.events,n):t.events=n,t.data?m.defaults(t.data,e):t.data=e}function u(t,e,n,i){if(t+="",t=t.replace(/px/gi,""),t.indexOf("%")!==-1&&(t=t.replace(/(\d+(?:\.\d+)?)%/gi,function(t,r){return(i?$(window)["outer"+n]():$(e)["outer"+n]())*(r/100)})),/[+\-*\/]/.test(t))try{t=new Function("return "+t)()}catch(r){throw new Error("Invalid position value: "+t)}return l(t)}function l(t){return parseFloat(t,10)||0}function c(t){return $.contains(document.documentElement,t)}function f(t){K.blurOverlays.forEach(function(e,n){if(n&&n.get("visible")){for(var i=0;i<n._relativeElements.length;i++){var r=$(n._relativeElements[i])[0];if(r===t.target||$.contains(r,t.target))return}n.hide()}})}var h,p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,r){var s={key:t,arg:e,resolve:n,reject:r,next:null};a?a=a.next=s:(o=a=s,i(t,e))})}function i(n,o){try{var a=e[n](o),s=a.value;s instanceof t?Promise.resolve(s.value).then(function(t){i("next",t)},function(t){i("throw",t)}):r(a.done?"return":"normal",a.value)}catch(u){r("throw",u)}}function r(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}o=o.next,o?i(o.key,o.arg):a=null}var o,a;this._invoke=n,"function"!=typeof e["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype["throw"]=function(t){return this._invoke("throw",t)},e.prototype["return"]=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),d=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),y=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},_=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},g=function it(t,e,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:it(r,e,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},b=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},O=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},w=0,k=Object.prototype,m=(h={isFunction:function(t){return e("Function")(t)},isObject:function(t){return e("Object")(t)},has:function(t,e){return null!=t&&k.hasOwnProperty.call(t,e)},create:function(t,e){return this.isObject(e)&&Object.keys(e).forEach(function(n){t[n]=e[n]}),t},defaults:function(t,e){var n=Object.keys(e);return n.forEach(function(n){t[n]&&void 0!==t[n]||(t[n]=e[n])}),t},mergeData:function(t,e){var n=void 0,i=void 0,r=void 0;for(n in e)i=t[n],r=e[n],Object.hasOwnProperty(t,n)?this.isObject(i)&&this.isObject(r)&&this.mergeData(i,r):Object.defineProperty(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r})}},y(h,"has",function(t,e){return null!=t&&k.hasOwnProperty.call(t,e)}),y(h,"equal",function(t,e,n,i){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;var r=k.toString,o=r.call(t);if(o!==r.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var a="[object Array]"===o;if(!a){if("object"!=("undefined"==typeof t?"undefined":p(t))||"object"!=("undefined"==typeof e?"undefined":p(e)))return!1;var s=t.constructor,u=e.constructor;if(s!==u&&!(this.isFunction(s)&&s instanceof s&&this.isFunction(u)&&u instanceof u)&&"constructor"in t&&"constructor"in e)return!1}n=n||[],i=i||[];for(var l=n.length;l--;)if(n[l]===t)return i[l]===e;if(n.push(t),i.push(e),a){if(l=t.length,l!==e.length)return!1;for(;l--;)if(!this.equal(t[l],e[l],n,i))return!1}else{var c,f=Object.keys(t);if(l=f.length,Object.keys(e).length!==l)return!1;for(;l--;)if(c=f[l],!this.has(e,c)||!this.equal(t[c],e[c],n,i))return!1}return n.pop(),i.pop(),!0}),h),j=/^(\S+)\s*(.*)$/,P=function(){function t(e){v(this,t),this._init(e)}return d(t,[{key:"_init",value:function(t){var e=this;if(!t)return Object.create(null);var n=Object.keys(t);this.state=t;for(var i=this,r=function(){var t=n[o],r=e.state[n[o]];return s=Object.getOwnPropertyDescriptor(e.state,t),s&&s.configurable===!1?"continue":void Object.defineProperty(i.state,t,{enumerable:!0,configurable:!0,get:function(){return r},set:function(t){var e=r;t!==e&&(r=t)}})},o=0,a=n.length;o<a;o++){var s;r()}}}]),t}(),x=function(t,e){var n,i=this;return n=t&&m.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},_(n,i,e),n.prototype=m.create(i.prototype,t),n.prototype.constructor=n,n.__super__=i.prototype,n},E={},S={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},M=function(t){var e=function(e){return t[e]},n="(?:"+Object.keys(t).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,e):t}};E.escape=M(S);var T={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},D=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\u2028|\u2029/g,W=function(t){return"\\"+B[t]},I=/<[^>]+>/g,A="",F=function(){function t(e){v(this,t),this._init(e)}return d(t,null,[{key:"$",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){if(window.jQuery||window.$||$)return window.jQuery||window.$||$;throw new Error("GMP need jQuery or Zepto in window scope named $")})},{key:"_assignPros",value:function(e){_(t.prototype,e)}}]),t}();t(F),n(F),r(F),o(F),F.GMPX=P,F.extend=x,F.template=a;var C='<button id="<%=id%>" href="javascript:void 0;"\n        tabindex="0"\n        role="button"\n        aria-disabled="false"\n        aria-pressed="false"><%=value%></button>',z=function(t){function e(t){v(this,e);var n=!!t.init==!0?t.init:null;t.init&&delete t.init;var i=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return null!=n?i.on("_on_init",n):"",i.on("_on_after",i._after),i}return b(e,t),d(e,[{key:"_after",value:function(t){if(!t)throw new Error("\u8bf7\u6b63\u786e\u586b\u5199\u5c5e\u6027!");this._create(),this.trigger("_on_init")}},{key:"_create",value:function(t){this.data?this.$el.html(F.template(t)(this.data)):this.$el.html(F.template(t)())}},{key:"_appendTo",value:function(t){var e=t;return e&&(e.jquery||e.nodeType)?$(e)[0]:document.querySelector(e||"body")}},{key:"set",value:function(t,e){var n=this.data[t];this.data[t]=e;var i=this["_on_"+t+"Update"];m.isFunction(i)&&i.call(this,e,n)}},{key:"get",value:function(t){return this.data[t]}}],[{key:"inherits",value:function(t,e){var n=this,i=void 0;return i=t&&m.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},_(i,n,e),i.prototype=m.create(n.prototype,t),i.prototype.constructor=i,i.__super__=n.prototype,i}}]),e}(F),q=function(t){function e(t){v(this,e);var n=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_create",n).call(n,C),n}return b(e,t),d(e,[{key:"preinit",value:function(){console.log("preinit....")}},{key:"enable",value:function(){$(this.$options.el).find("[role=button]").attr("aria-disabled",!1).removeAttr("disabled")}},{key:"disable",value:function(){$(this.$options.el).find("[role=button]").attr("aria-disabled",!0).attr("disabled",!0)}}]),e}(z),G='<div class="m-dialog" role=\'alertdialog\'>\n    <div class="dialog-tit"><%=title%></div>\n    <div class="dialog-txt"><%=msg%></div>\n    <div class="dialog-btn">\n        <a href="javascript:;" role=\'button\' class="default okBtn" aria-controls=\'ok\'>\u786e\u5b9a</a>\n        <a href="javascript:;" role=\'button\' class="primary cancelBtn" aria-controls=\'cancel\'>\u53d6\u6d88</a>\n    </div>\n</div>',R=function(t){function e(t){v(this,e),s(t);var n=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.trigger("_on_after",t),n}return b(e,t),d(e,[{key:"_create",value:function(){this._createWrapper();var t=GMP.template(G)(this.data);this.uiAlert.append(t)}},{key:"_createWrapper",value:function(){this.uiAlert=$("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo(this.el))}},{key:"open",value:function(){this.uiAlert.show()}},{key:"ok",value:function(){$(this.el).hide()}},{key:"cancel",value:function(){$(this.el).hide()}}]),e}(z),H='<div class="m-dialog" role=\'confirmdialog\'>\n    <div class="dialog-tit"><%=title%></div>\n    <div class=\'dialog-content dialog-txt\'>\n        <%=msg%>\n    </div>\n    <div class="dialog-btn">\n        <a href="javascript:;" role=\'button\' class="default okBtn" aria-controls=\'ok\'>\u786e\u5b9a</a>\n        <a href="javascript:;" role=\'button\' class="primary cancelBtn" aria-controls=\'ok\'>\u53d6\u6d88</a>\n    </div>\n</div>',U=function(t){function e(t){v(this,e),s(t);var n=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.trigger("_on_after",t),n}return b(e,t),d(e,[{key:"_create",value:function(){this._createWrapper();var t=GMP.template(H)(this.data);this.uiConfirm.append(t)}},{key:"_createWrapper",value:function(){this.uiConfirm=$("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo(this.el))}},{key:"open",value:function(){this.uiConfirm.show()}},{key:"ok",value:function(){this.uiConfirm.hide()}},{key:"cancel",value:function(){this.uiConfirm.hide()}}]),e}(z),Q={title:"\u6807\u9898"},N={layer:'<div class="layer"></div>',header:'<h2 class="dialog-header"><%=title%></h2>',footer:'<div class="dialog-footer"><a href="javascript: void 0;" role="button" class="okBtn" aria-controls="ok">\u786e\u5b9a</a><a href="javascript: void 0;" role="button" class="cancelBtn" aria-controls="cancel">\u53d6\u6d88</a></div>'},X=/<[^>]+>/g,Z=function(t){function e(t){v(this,e),s(t,Q);var n=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.trigger("_on_after",t),n}return b(e,t),d(e,[{key:"_create",value:function(t){this._createWrapper();var e=void 0,n=void 0,i=void 0,r=this.data;e=r.header?X.test(r.header)?r.header:$(r.header).html():N.header,n=r.content?X.test(r.content)?r.content:$(r.content).html():N.content||'<p style="text-align: center">\u6b63\u6587</p>',i=r.footer?X.test(r.footer)?r.footer:$(r.footer).html():N.footer;var o=e+n+i;$(o).show().removeAttr("title").appendTo(this.uiDialog);var a=GMP.template(o)(this.data);this.uiDialog.html(a)}},{key:"_createWrapper",value:function(){this.uiDialog=$("<div>").addClass("dialog").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo(this.el))}},{key:"_createOverLay",value:function(){this.overlay=$(N.layer).appendTo(this._appendTo(this.el))}},{key:"_destroyOverLay",value:function(){this.overlay.remove()}},{key:"ok",value:function(){this.close()}},{key:"cancel",value:function(){this.close()}},{key:"open",value:function(){this.uiDialog&&(this._createOverLay(),this.uiDialog.show())}},{key:"close",value:function(){this._destroyOverLay(),this.uiDialog.hide()}},{key:"destory",value:function(){this.uiDialog.remove()}}]),e}(z),J={pin:function(t,e,n){var i=!n;t=$(t),n=n?$(n):$(window),t.css("position","absolute"),e={x:u(e.x,t,"Width",i),y:u(e.y,t,"Height",i)},i?t.offset({left:e.x,top:e.y}):t.offset({left:n.offset().left+e.x,top:n.offset().top+e.y})},centerInWindow:function(t){this.pin(t,{x:"50%-"+$(t).width()/2,y:"50%-"+$(t).height()/2})}},K=function(t){function e(t){v(this,e);var n=O(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.setup(),n._create(F.template('<div style="z-index:<%=zIndex%>;width:<%=width%>px;height:<%=height%>px;" class="<%=clsName%>"></div>')(t.data)),n}return b(e,t),d(e,[{key:"_create",value:function(t){this.uiOverlay=$(t),$("body").append(this.uiOverlay),this.trigger("create")}},{key:"show",value:function(){return this.set("visible",!0),this.trigger("show"),this}},{key:"hide",value:function(){return this.set("visible",!1),this.trigger("hide"),this}},{key:"setup",value:function(){var t=this;this._setupResize(),this.on("create",function(){console.log("create");var e=t.uiOverlay.css("position");"static"!==e&&"relative"!==e||t.uiOverlay.css({position:"absolute",left:"-9999px",top:"-9999px"})}),this.on("show",function(){console.log("show"),t._setPosition()})}},{key:"_setupResize",value:function(){e.allOverlays.push(this)}},{key:"_setPosition",value:function(){if(c(this.uiOverlay[0])){var t={x:this.data.x,y:this.data.y};if(t.x||t.y){var e="none"===this.uiOverlay.css("display");return e&&this.uiOverlay.css({visibility:"hidden",display:"block"}),J.pin(this.uiOverlay,t,this.data.alignBase),e&&this.uiOverlay.css({visibility:"",display:"none"}),this}}}},{key:"_blurHide",value:function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];n.push(this.uiOverlay),this._relativeElements=n,e.blurOverlays.push(this)}},{key:"destroy",value:function(){var t=this;e.allOverlays=e.allOverlays.filter(function(e){return t!==e}),e.blurOverlays=e.blurOverlays.filter(function(e){return t!==e}),g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destory",this)&&g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}},{key:"_on_widthUpdate",value:function(t){this.uiOverlay.css("width",t)}},{key:"_on_heightUpdate",value:function(t){this.uiOverlay.css("height",t)}},{key:"_on_zIndexUpdate",value:function(t){this.uiOverlay.css("zIndex",t)}},{key:"_on_visibleUpdate",value:function(t){this.uiOverlay[t?"show":"hide"]()}}]),e}(z);K.allOverlays=[],K.blurOverlays=[],$(document).on("click",function(t){f(t)});var V,Y=$(window).width(),tt=$(window).height();$(window).resize(function(){V&&clearTimeout(V),V=setTimeout(function(){var t=$(window).width(),e=$(window).height();Y===t&&tt===e||$(K.allOverlays).each(function(t,e){e&&e.get("visible")&&e._setPosition()}),Y=t,tt=e},80)});var et=Object.freeze({Button:q,Alert:R,Confirm:U,Modal:Z,Position:J,Overlay:K});F.Widgets=function(){},F.Widgets.register=function(t,e){if(null!=this[t])throw new Error("\u5df2\u5b58\u5728\u8be5\u540d\u79f0\u7684Widgets,\u8bf7\u6539\u540d!");this[t]=z.inherits(e)},_(F.Widgets,et);var nt=function(){$("body").addClass("opg")};return nt(),F});